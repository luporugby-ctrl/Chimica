<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tavola Periodica & Stechiometria - Mercatorum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        
        // Wrapper per icone Lucide
        const Icon = ({ name, className }) => <i data-lucide={name} className={className}></i>;

        const ELEMENTS = [
            { number: 1, symbol: 'H', name: 'Idrogeno', mass: 1.008, group: 'non-metal', x: 1, y: 1 },
            { number: 2, symbol: 'He', name: 'Elio', mass: 4.0026, group: 'noble-gas', x: 18, y: 1 },
            { number: 3, symbol: 'Li', name: 'Litio', mass: 6.94, group: 'alkali-metal', x: 1, y: 2 },
            { number: 4, symbol: 'Be', name: 'Berillio', mass: 9.0122, group: 'alkaline-earth', x: 2, y: 2 },
            { number: 5, symbol: 'B', name: 'Boro', mass: 10.81, group: 'metalloid', x: 13, y: 2 },
            { number: 6, symbol: 'C', name: 'Carbonio', mass: 12.011, group: 'non-metal', x: 14, y: 2 },
            { number: 7, symbol: 'N', name: 'Azoto', mass: 14.007, group: 'non-metal', x: 15, y: 2 },
            { number: 8, symbol: 'O', name: 'Ossigeno', mass: 15.999, group: 'non-metal', x: 16, y: 2 },
            { number: 9, symbol: 'F', name: 'Fluoro', mass: 18.998, group: 'halogen', x: 17, y: 2 },
            { number: 10, symbol: 'Ne', name: 'Neon', mass: 20.180, group: 'noble-gas', x: 18, y: 2 },
            { number: 11, symbol: 'Na', name: 'Sodio', mass: 22.990, group: 'alkali-metal', x: 1, y: 3 },
            { number: 12, symbol: 'Mg', name: 'Magnesio', mass: 24.305, group: 'alkaline-earth', x: 2, y: 3 },
            { number: 13, symbol: 'Al', name: 'Alluminio', mass: 26.982, group: 'post-transition', x: 13, y: 3 },
            { number: 14, symbol: 'Si', name: 'Silicio', mass: 28.085, group: 'metalloid', x: 14, y: 3 },
            { number: 15, symbol: 'P', name: 'Fosforo', mass: 30.974, group: 'non-metal', x: 15, y: 3 },
            { number: 16, symbol: 'S', name: 'Zolfo', mass: 32.06, group: 'non-metal', x: 16, y: 3 },
            { number: 17, symbol: 'Cl', name: 'Cloro', mass: 35.45, group: 'halogen', x: 17, y: 3 },
            { number: 18, symbol: 'Ar', name: 'Argon', mass: 39.948, group: 'noble-gas', x: 18, y: 3 },
            { number: 19, symbol: 'K', name: 'Potassio', mass: 39.098, group: 'alkali-metal', x: 1, y: 4 },
            { number: 20, symbol: 'Ca', name: 'Calcio', mass: 40.078, group: 'alkaline-earth', x: 2, y: 4 },
            { number: 21, symbol: 'Sc', name: 'Scandio', mass: 44.956, group: 'transition-metal', x: 3, y: 4 },
            { number: 22, symbol: 'Ti', name: 'Titanio', mass: 47.867, group: 'transition-metal', x: 4, y: 4 },
            { number: 23, symbol: 'V', name: 'Vanadio', mass: 50.942, group: 'transition-metal', x: 5, y: 4 },
            { number: 24, symbol: 'Cr', name: 'Cromo', mass: 51.996, group: 'transition-metal', x: 6, y: 4 },
            { number: 25, symbol: 'Mn', name: 'Manganese', mass: 54.938, group: 'transition-metal', x: 7, y: 4 },
            { number: 26, symbol: 'Fe', name: 'Ferro', mass: 55.845, group: 'transition-metal', x: 8, y: 4 },
            { number: 27, symbol: 'Co', name: 'Cobalto', mass: 58.933, group: 'transition-metal', x: 9, y: 4 },
            { number: 28, symbol: 'Ni', name: 'Nichel', mass: 58.693, group: 'transition-metal', x: 10, y: 4 },
            { number: 29, symbol: 'Cu', name: 'Rame', mass: 63.546, group: 'transition-metal', x: 11, y: 4 },
            { number: 30, symbol: 'Zn', name: 'Zinco', mass: 65.38, group: 'transition-metal', x: 12, y: 4 },
            { number: 31, symbol: 'Ga', name: 'Gallio', mass: 69.723, group: 'post-transition', x: 13, y: 4 },
            { number: 32, symbol: 'Ge', name: 'Germanio', mass: 72.630, group: 'metalloid', x: 14, y: 4 },
            { number: 33, symbol: 'As', name: 'Arsenico', mass: 74.922, group: 'metalloid', x: 15, y: 4 },
            { number: 34, symbol: 'Se', name: 'Selenio', mass: 78.971, group: 'non-metal', x: 16, y: 4 },
            { number: 35, symbol: 'Br', name: 'Bromo', mass: 79.904, group: 'halogen', x: 17, y: 4 },
            { number: 36, symbol: 'Kr', name: 'Kripton', mass: 83.798, group: 'noble-gas', x: 18, y: 4 },
            { number: 37, symbol: 'Rb', name: 'Rubidio', mass: 85.468, group: 'alkali-metal', x: 1, y: 5 },
            { number: 38, symbol: 'Sr', name: 'Stronzio', mass: 87.62, group: 'alkaline-earth', x: 2, y: 5 },
            { number: 47, symbol: 'Ag', name: 'Argento', mass: 107.87, group: 'transition-metal', x: 11, y: 5 },
            { number: 79, symbol: 'Au', name: 'Oro', mass: 196.97, group: 'transition-metal', x: 11, y: 6 },
            { number: 80, symbol: 'Hg', name: 'Mercurio', mass: 200.59, group: 'transition-metal', x: 12, y: 6 },
            { number: 82, symbol: 'Pb', name: 'Piombo', mass: 207.2, group: 'post-transition', x: 14, y: 6 },
        ];

        const GROUP_STYLES = {
            'alkali-metal': 'bg-red-50 border-red-200 text-red-800',
            'alkaline-earth': 'bg-orange-50 border-orange-200 text-orange-800',
            'transition-metal': 'bg-yellow-50 border-yellow-200 text-yellow-800',
            'post-transition': 'bg-green-50 border-green-200 text-green-800',
            'metalloid': 'bg-teal-50 border-teal-200 text-teal-800',
            'non-metal': 'bg-blue-50 border-blue-200 text-blue-800',
            'halogen': 'bg-indigo-50 border-indigo-200 text-indigo-800',
            'noble-gas': 'bg-purple-50 border-purple-200 text-purple-800',
        };

        const AVOGADRO = 6.022e23;

        function App() {
            const [search, setSearch] = useState('');
            const [selectedElement, setSelectedElement] = useState(null);
            const [massInput, setMassInput] = useState('');
            const [moleInput, setMoleInput] = useState('');
            const [aiLoading, setAiLoading] = useState(false);
            const [aiResponse, setAiResponse] = useState('');
            const [aiError, setAiError] = useState('');

            useEffect(() => { lucide.createIcons(); }, [selectedElement, aiResponse, search]);

            const apiKey = ""; 

            const callGemini = async (prompt) => {
                setAiLoading(true); setAiError(''); setAiResponse('');
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: "Sei un tutor di chimica della Mercatorum. Rispondi in italiano. Se crei esercizi, non dare mai la soluzione numerica subito." }] }
                        })
                    });
                    const data = await response.json();
                    setAiResponse(data.candidates?.[0]?.content?.parts?.[0]?.text || "Nessuna risposta ricevuta.");
                } catch (err) {
                    setAiError("Connessione AI fallita.");
                } finally {
                    setAiLoading(false);
                }
            };

            const handleMassChange = (val) => {
                setMassInput(val);
                if (val && !isNaN(val) && selectedElement) {
                    setMoleInput((parseFloat(val) / selectedElement.mass).toFixed(4));
                } else if (!val) setMoleInput('');
            };

            const handleMoleChange = (val) => {
                setMoleInput(val);
                if (val && !isNaN(val) && selectedElement) {
                    setMassInput((parseFloat(val) * selectedElement.mass).toFixed(4));
                } else if (!val) setMassInput('');
            };

            const filteredElements = ELEMENTS.filter(el => 
                el.name.toLowerCase().includes(search.toLowerCase()) || 
                el.symbol.toLowerCase().includes(search.toLowerCase()) ||
                el.number.toString() === search
            );

            return (
                <div className="min-h-screen p-4 pb-32 flex flex-col">
                    <header className="max-w-7xl mx-auto mb-12 text-center w-full">
                        <h1 className="text-4xl font-black text-slate-800 flex items-center justify-center gap-3">
                            <Icon name="sparkles" className="text-blue-500" /> Tavola Periodica & Stechiometria
                        </h1>
                        <p className="text-slate-500 mt-2 font-medium">Supporto Studio Ingegneria Gestionale - Mercatorum</p>
                    </header>

                    <main className="flex-1">
                        <div className="max-w-7xl mx-auto overflow-x-auto pb-8">
                            <div className="grid gap-1 min-w-[1000px]" style={{ gridTemplateColumns: 'repeat(18, 1fr)' }}>
                                {ELEMENTS.map(el => {
                                    const active = filteredElements.includes(el);
                                    return (
                                        <button
                                            key={el.number}
                                            onClick={() => {
                                                setSelectedElement(el);
                                                setMassInput(el.mass.toString());
                                                setMoleInput('1');
                                            }}
                                            style={{ gridColumn: el.x, gridRow: el.y }}
                                            className={`relative flex flex-col items-center justify-center p-2 border-2 rounded-xl aspect-square transition-all duration-300 hover:scale-110 hover:shadow-lg hover:z-10 ${GROUP_STYLES[el.group] || 'bg-slate-50'} ${active ? 'opacity-100' : 'opacity-10 blur-[1px]'}`}
                                        >
                                            <span className="absolute top-1 left-1.5 text-[10px] font-bold opacity-40">#{el.number}</span>
                                            <span className="text-xl font-black">{el.symbol}</span>
                                            <span className="text-[8px] font-bold uppercase truncate w-full text-center px-1">{el.name}</span>
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </main>

                    {/* Firma e Barra di ricerca */}
                    <div className="fixed bottom-0 left-0 right-0 p-6 flex flex-col items-center gap-4 bg-gradient-to-t from-slate-50 via-slate-50/90 to-transparent z-40">
                        <div className="relative w-full max-w-lg group">
                            <div className="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"><Icon name="search" /></div>
                            <input
                                type="text"
                                placeholder="Cerca elemento o numero atomico..."
                                value={search}
                                onChange={(e) => setSearch(e.target.value)}
                                className="w-full pl-14 pr-6 py-5 bg-white rounded-3xl shadow-2xl border border-slate-200 focus:outline-none focus:ring-4 focus:ring-blue-100 font-semibold text-slate-700 transition-all"
                            />
                        </div>
                        <div className="text-slate-400 text-xs font-bold tracking-widest uppercase pb-2">
                            by Andrea Lupetti
                        </div>
                    </div>

                    {selectedElement && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="w-full max-w-4xl bg-white rounded-[3rem] shadow-2xl overflow-hidden flex flex-col md:flex-row h-[85vh]">
                                <div className={`md:w-1/3 p-10 flex flex-col items-center justify-center text-center ${GROUP_STYLES[selectedElement.group] || 'bg-slate-100'}`}>
                                    <span className="text-3xl font-bold opacity-30 mb-2">#{selectedElement.number}</span>
                                    <div className="text-9xl font-black tracking-tighter mb-4">{selectedElement.symbol}</div>
                                    <h2 className="text-3xl font-black uppercase tracking-widest">{selectedElement.name}</h2>
                                    <div className="mt-6 bg-white/40 px-6 py-2 rounded-full font-bold text-sm">Massa: {selectedElement.mass} u</div>
                                </div>

                                <div className="md:w-2/3 p-10 overflow-y-auto flex flex-col bg-white">
                                    <div className="flex justify-between items-center mb-8">
                                        <h3 className="text-2xl font-black text-slate-800 flex items-center gap-3">
                                            <Icon name="calculator" className="text-blue-500" /> Strumenti di Calcolo
                                        </h3>
                                        <button onClick={() => setSelectedElement(null)} className="p-2 bg-slate-100 hover:bg-slate-200 rounded-full transition-colors"><Icon name="x" /></button>
                                    </div>

                                    <div className="space-y-8">
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div className="space-y-2">
                                                <label className="text-xs font-black text-slate-400 uppercase tracking-widest">Massa Campione (g)</label>
                                                <div className="relative">
                                                    <input type="number" value={massInput} onChange={(e) => handleMassChange(e.target.value)} className="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-blue-400 outline-none font-bold text-lg" />
                                                    <span className="absolute right-4 top-4 text-slate-300 font-bold">g</span>
                                                </div>
                                            </div>
                                            <div className="space-y-2">
                                                <label className="text-xs font-black text-slate-400 uppercase tracking-widest">Quantità (mol)</label>
                                                <div className="relative">
                                                    <input type="number" value={moleInput} onChange={(e) => handleMoleChange(e.target.value)} className="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-blue-400 outline-none font-bold text-lg" />
                                                    <span className="absolute right-4 top-4 text-slate-300 font-bold">mol</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-slate-900 text-white p-6 rounded-[2rem] flex flex-col items-center shadow-xl">
                                            <Icon name="hash" className="text-blue-400 mb-2" />
                                            <div className="text-3xl font-black text-blue-100">
                                                {(parseFloat(moleInput || 0) * AVOGADRO).toExponential(3)}
                                            </div>
                                            <p className="text-[10px] uppercase font-bold text-slate-500 mt-2 tracking-widest">Atomi totali nel campione</p>
                                        </div>

                                        <div className="pt-8 border-t border-slate-100">
                                            <p className="text-sm font-black text-slate-800 mb-4 flex items-center gap-2">
                                                <Icon name="sparkles" className="text-purple-500" /> Chiedi al Tutor Gemini
                                            </p>
                                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                                <button onClick={() => callGemini(`Dimmi una curiosità tecnologica moderna sull'elemento ${selectedElement.name}.`)} className="py-3 px-4 bg-purple-50 text-purple-700 rounded-2xl font-bold text-xs hover:bg-purple-100 flex items-center justify-center gap-2"><Icon name="lightbulb" className="w-4 h-4" /> Curiosità</button>
                                                <button onClick={() => callGemini(`Spiega cos'è una mole di ${selectedElement.name} usando un'analogia con oggetti comuni.`)} className="py-3 px-4 bg-indigo-50 text-indigo-700 rounded-2xl font-bold text-xs hover:bg-indigo-100 flex items-center justify-center gap-2"><Icon name="brain-circuit" className="w-4 h-4" /> Analogia</button>
                                                <button onClick={() => callGemini(`Genera un esercizio di stechiometria per l'elemento ${selectedElement.name} (massa ${selectedElement.mass}). Non darmi il risultato, scrivimi solo il testo del problema. Metterò alla prova le mie conoscenze.`)} className="py-3 px-4 bg-emerald-50 text-emerald-700 rounded-2xl font-bold text-xs hover:bg-emerald-100 flex items-center justify-center gap-2"><Icon name="send" className="w-4 h-4" /> Esercizio</button>
                                            </div>
                                        </div>

                                        <div className="relative min-h-[100px] bg-slate-50 rounded-3xl p-6 border border-slate-100 italic text-slate-600 text-sm">
                                            {aiLoading ? "Gemini sta scrivendo..." : aiError ? <span className="text-red-500">{aiError}</span> : aiResponse || "Seleziona un'azione AI per approfondire..."}
                                        </div>
                                    </div>
                                    <div className="mt-8 text-center text-slate-300 text-[10px] font-bold uppercase tracking-widest">
                                        Progetto Didattico by Andrea Lupetti
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
